<section class="px-6 pt-8 notification-top-area">
  <div class="d-flex justify-content-between align-items-center py-3">
    <div class="d-flex align-items-center gap-3">
      <a routerLink="/" class="back-button flex-center text-decoration-none text-dark">
        <i class="ph ph-caret-left fs-4" style="color: #fff;"></i>
      </a>
      <h2 class="mb-0 fw-semibold">Mis servicios</h2>
    </div>

    <!-- BotÃ³n agregar servicio -->
    <button
      class="btn rounded-circle shadow d-flex align-items-center justify-content-center"
      title="Agregar servicio"
      (click)="toggleForm()"
      style="width: 48px; height: 48px; font-size: 22px; background-color: var(--n1); color: #fff;"
    >
      <i class="ph ph-plus"></i>
    </button>
  </div>
</section>

<!-- FORMULARIO NUEVO SERVICIO -->
<div class="px-6" *ngIf="showForm">
  <form
    (ngSubmit)="addService()"
    [formGroup]="serviceForm"
    class="p-4 bg-light rounded-4 shadow-sm my-4"
  >
    <h4 class="mb-4 fw-semibold text-center">Agregar nuevo servicio</h4>

    <div class="form-group mb-3">
      <label class="fw-semibold">Nombre</label>
      <input
        type="text"
        class="form-control"
        formControlName="name"
        placeholder="Ej: AplicaciÃ³n de medicamentos"
      />
    </div>

    <div class="form-group mb-3">
      <label class="fw-semibold">Precio (COP)</label>
      <input
        type="number"
        class="form-control"
        formControlName="price"
        placeholder="Ej: 30000"
      />
    </div>

    <div class="form-group mb-3">
      <label class="fw-semibold">DescripciÃ³n</label>
      <textarea
        rows="3"
        class="form-control"
        formControlName="description"
        placeholder="Breve descripciÃ³n"
      ></textarea>
    </div>

    <!-- âœ… SelecciÃ³n de icono -->
    <div class="form-group mb-3">
      <label class="fw-semibold">Icono del servicio</label>
      <select class="form-select" formControlName="icon">
        <option value="">Seleccionar icono</option>
        <option value="syringe">ðŸ’‰ Jeringa</option>
        <option value="bandage">ðŸ©¹ CuraciÃ³n</option>
        <option value="monitor">ðŸ©º Monitor</option>
        <option value="catheter">ðŸ§« Sonda</option>
        <option value="glucometer">ðŸ©¸ GlucometrÃ­a</option>
      </select>
    </div>

    <!-- âœ… Requiere fÃ³rmula mÃ©dica -->
    <div class="form-group mb-4">
      <label class="fw-semibold">Â¿Requiere fÃ³rmula mÃ©dica?</label>
      <div class="d-flex gap-4 mt-2">
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            formControlName="requiresPrescription"
            [value]="true"
            id="reqSi"
          />
          <label for="reqSi" class="form-check-label">SÃ­</label>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            formControlName="requiresPrescription"
            [value]="false"
            id="reqNo"
          />
          <label for="reqNo" class="form-check-label">No</label>
        </div>
      </div>
    </div>

    <div class="form-group mb-3">
      <label class="fw-semibold">Imagen (opcional)</label>
      <input type="file" class="form-control" (change)="onImageSelected($event)" />
    </div>

    <div class="d-flex justify-content-end gap-3 mt-4">
      <button type="button" class="btn btn-outline-secondary px-4" (click)="toggleForm()">
        Cancelar
      </button>
      <button type="submit" class="btn btn-primary px-4" [disabled]="loading || serviceForm.invalid">
        {{ loading ? 'Guardando...' : 'Guardar' }}
      </button>
    </div>

    <p *ngIf="errorMsg" class="text-danger mt-3">{{ errorMsg }}</p>
  </form>
</div>

<!-- LISTADO DE SERVICIOS -->
<div class="px-6 pb-5 w-100 appoinment-tab-area">
  <div class="tab-content activeTab">
    <div class="top-doctor-area">
      <div class="row g-4">
        <!-- CARD DE SERVICIO -->
        <div class="col-12 col-md-6 col-lg-4" *ngFor="let servicio of servicios">
          <div class="p-4 border rounded-4 shadow-sm h-100 d-flex flex-column justify-content-between">
            <div class="d-flex align-items-start gap-3">
              <div class="flex-shrink-0" style="width: 64px; height: 64px;">
                <img
                  [src]="getImageUrl(servicio)"
                  class="rounded-3 w-100 h-100 object-fit-cover"
                  alt="imagen servicio"
                />
              </div>
              <div class="flex-grow-1">
                <p class="fw-bold mb-1">
                  {{
                    servicio.icon === 'syringe'
                      ? 'ðŸ’‰'
                      : servicio.icon === 'bandage'
                      ? 'ðŸ©¹'
                      : servicio.icon === 'monitor'
                      ? 'ðŸ©º'
                      : servicio.icon === 'catheter'
                      ? 'ðŸ§«'
                      : servicio.icon === 'glucometer'
                      ? 'ðŸ©¸'
                      : ''
                  }}
                  {{ servicio.name }}
                </p>
                <p class="text-muted small mb-1">{{ servicio.description }}</p>
                <p class="fw-semibold text-primary mb-1">
                  $ {{ servicio.price | number : '1.0-0' }}
                </p>

                <p *ngIf="servicio.requiresPrescription" class="text-danger small mt-1 mb-0">
                  <i class="ph ph-warning-circle"></i> Requiere fÃ³rmula mÃ©dica
                </p>
              </div>
            </div>

            <!-- Botones alineados al final -->
            <div class="d-flex justify-content-end align-items-center gap-2 mt-3 pt-2 border-top">
<!--               <button class="btn btn-sm btn-outline-primary px-3">Editar</button>
 -->              <button
                class="btn btn-sm btn-outline-danger px-3"
                (click)="deleteService(servicio)"
              >
                Eliminar
              </button>
            </div>
          </div>
        </div>
        <!-- /CARD -->
      </div>
    </div>
  </div>
</div>
