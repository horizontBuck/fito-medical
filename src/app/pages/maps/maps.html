<div class="map-container position-relative" *ngIf="mapReady && center">
  <input
    type="text"
    placeholder="Buscar lugar..."
    class="search-box"
    #search
  />

  <google-map
    [center]="center"
    [zoom]="zoom"
    height="100vh"
    width="100%"
  >
    <map-circle
      [center]="center"
      [radius]="radius"
      [options]="{
        strokeColor: '#00AEEF',
        strokeOpacity: 0.6,
        strokeWeight: 1,
        fillColor: '#00AEEF',
        fillOpacity: 0.15
      }"
    ></map-circle>

    <!-- Paciente -->
    <map-marker
      *ngIf="selectedMarker"
      [position]="selectedMarker"
      [options]="{
        icon: {
          url: 'https://maps.google.com/mapfiles/ms/icons/blue-dot.png'
        }
      }"
      title="Tu ubicación"
    ></map-marker>

    <!-- Profesionales -->
    <map-marker
      *ngFor="let pro of nearbyPros"
      #marker="mapMarker"
      [position]="{ lat: pro.lat, lng: pro.lng }"
      [title]="pro.name"
      (mapClick)="openInfo(marker, pro)"
      [options]="{
        icon: {
          url: 'https://maps.google.com/mapfiles/ms/icons/green-dot.png'
        }
      }"
    ></map-marker>

    <!-- InfoWindow -->
   <map-info-window>
  <div
    class="info-card text-center p-2"
    style="
      width: 220px;
      font-family: 'Work Sans', sans-serif;
    "
  >
    <!-- Avatar -->
    <img
      [src]="selectedPro?.avatarFile
        ? professionalsService.getAvatarUrl(selectedPro)
        : 'assets/img/default-avatar.png'"
      alt="Avatar"
      class="avatar shadow-sm"
      style="
        width: 65px;
        height: 65px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #0fa49e;
        margin-bottom: 8px;
      "
    />

    <!-- Nombre y profesión -->
    <div>
      <h6
        style="
          margin: 0;
          font-weight: 600;
          color: #222;
          font-size: 15px;
        "
      >
        {{ selectedPro?.name }}
      </h6>
      <p
        style="
          margin: 0;
          color: #666;
          font-size: 13px;
        "
      >
        {{ selectedPro?.profession || 'Profesional de la salud' }}
      </p>
    </div>

    <hr
      style="
        margin: 8px 0;
        border: none;
        border-top: 1px solid #e0e0e0;
      "
    />

    <!-- Botones -->
    <div class="d-flex justify-content-center gap-2 mt-1">
      <button
        class="btn btn-sm"
        style="
          background-color: #00a8e8;
          color: #fff;
          font-size: 12px;
          padding: 3px 8px;
          border-radius: 8px;
        "
        (click)="openProfessionalDetail(selectedPro)"
      >
        Ver perfil
      </button>

      <button
        class="btn btn-sm"
        style="
          background-color: #28a745;
          color: #fff;
          font-size: 12px;
          padding: 3px 8px;
          border-radius: 8px;
        "
        (click)="requestService(selectedPro)"
      >
        Solicitar
      </button>
    </div>
  </div>
</map-info-window>

  </google-map>
</div>

<div *ngIf="!mapReady" class="flex-center" style="height: 100vh;">
  <i class="ph-duotone ph-spinner fa-spin fs-3"></i>
  <p class="ms-2">Cargando mapa...</p>
</div>
<div *ngIf="!center && mapReady" class="flex-center" style="height: 100vh;">
  <p>Selecciona un lugar o permite tu ubicación para ver profesionales cercanos.</p>
</div>

